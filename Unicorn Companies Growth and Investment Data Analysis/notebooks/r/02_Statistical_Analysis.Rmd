---
title: "Descriptive, Inferential, and Exploratory Statistical Analysis"
author: "Data Science Team"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: show
    theme: flatly
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, 
                      fig.width = 12, fig.height = 8)

# Load required libraries
library(dplyr)
library(ggplot2)
library(tidyr)
library(readr)
library(corrplot)
library(gridExtra)
library(knitr)
library(broom)
```

## Objectives

1. Descriptive Statistics
2. Inferential Statistics
3. Hypothesis Testing
4. Correlation Analysis
5. Statistical Tests

## Load Cleaned Dataset

```{r load-data}
df <- read_csv("../../data/Unicorn_Companies_cleaned.csv")
cat("Dataset shape:", nrow(df), "rows,", ncol(df), "columns\n")
```

## 1. Descriptive Statistics

```{r descriptive-stats}
numeric_cols <- c("Valuation_B", "Total_Raised_B", "Investors Count", 
                  "Deal Terms", "Portfolio Exits", "Years_to_Unicorn")

# Basic descriptive statistics
desc_stats <- df %>%
  select(all_of(numeric_cols)) %>%
  summarise_all(list(
    mean = ~mean(., na.rm = TRUE),
    median = ~median(., na.rm = TRUE),
    sd = ~sd(., na.rm = TRUE),
    min = ~min(., na.rm = TRUE),
    max = ~max(., na.rm = TRUE),
    q25 = ~quantile(., 0.25, na.rm = TRUE),
    q75 = ~quantile(., 0.75, na.rm = TRUE)
  ))

# Additional statistics
cat("Descriptive Statistics:\n")
summary(df[numeric_cols])

# Skewness and Kurtosis
cat("\nSkewness and Kurtosis:\n")
for(col in numeric_cols) {
  if(sum(!is.na(df[[col]])) > 0) {
    skew <- e1071::skewness(df[[col]], na.rm = TRUE)
    kurt <- e1071::kurtosis(df[[col]], na.rm = TRUE)
    cv <- sd(df[[col]], na.rm = TRUE) / mean(df[[col]], na.rm = TRUE)
    cat(sprintf("%s: Skewness=%.4f, Kurtosis=%.4f, CV=%.4f\n", 
                col, skew, kurt, cv))
  }
}
```

## 2. Inferential Statistics - Hypothesis Testing

### Test 1: Compare valuations between US and China

```{r t-test-us-china}
us_val <- df %>% 
  filter(Country == "United States") %>% 
  pull(Valuation_B) %>% 
  na.omit()

china_val <- df %>% 
  filter(Country == "China") %>% 
  pull(Valuation_B) %>% 
  na.omit()

cat("Hypothesis Test 1: US vs China Valuations\n")
cat(sprintf("US Mean: %.2fB, China Mean: %.2fB\n", 
            mean(us_val), mean(china_val)))

# Two-sample t-test
t_test_result <- t.test(us_val, china_val)
print(t_test_result)

cat(sprintf("\nSignificant at α=0.05: %s\n", 
            t_test_result$p.value < 0.05))
```

### Test 2: ANOVA - Compare valuations across top industries

```{r anova}
top_industries <- df %>%
  count(Industry, sort = TRUE) %>%
  head(5) %>%
  pull(Industry)

industry_groups <- df %>%
  filter(Industry %in% top_industries) %>%
  select(Industry, Valuation_B) %>%
  na.omit()

cat("Hypothesis Test 2: ANOVA - Valuations across Industries\n")
anova_result <- aov(Valuation_B ~ Industry, data = industry_groups)
print(summary(anova_result))

p_value_anova <- summary(anova_result)[[1]][["Pr(>F)"]][1]
cat(sprintf("\nSignificant at α=0.05: %s\n", p_value_anova < 0.05))
```

### Test 3: Chi-square test - Country vs Financial Stage

```{r chi-square}
contingency_table <- table(df$Country, df$`Financial Stage`)
chi2_result <- chisq.test(contingency_table)

cat("Hypothesis Test 3: Chi-square test - Country vs Financial Stage\n")
print(chi2_result)

cat(sprintf("\nSignificant at α=0.05: %s\n", chi2_result$p.value < 0.05))
```

## 3. Correlation Analysis

```{r correlation}
corr_cols <- c("Valuation_B", "Total_Raised_B", "Investors Count", 
               "Deal Terms", "Portfolio Exits", "Years_to_Unicorn")

corr_matrix <- df %>%
  select(all_of(corr_cols)) %>%
  na.omit() %>%
  cor()

corrplot(corr_matrix, method = "color", type = "upper", 
         order = "hclust", tl.cex = 0.8, tl.col = "black",
         addCoef.col = "black", number.cex = 0.7)

# Pearson correlation tests
cat("\nPearson Correlation Tests:\n")
cat(sprintf("Valuation vs Total Raised: r=%.4f, p=%.4f\n",
            cor.test(df$Valuation_B, df$Total_Raised_B)$estimate,
            cor.test(df$Valuation_B, df$Total_Raised_B)$p.value))

cat(sprintf("Valuation vs Investors Count: r=%.4f, p=%.4f\n",
            cor.test(df$Valuation_B, df$`Investors Count`)$estimate,
            cor.test(df$Valuation_B, df$`Investors Count`)$p.value))

cat(sprintf("Total Raised vs Years to Unicorn: r=%.4f, p=%.4f\n",
            cor.test(df$Total_Raised_B, df$Years_to_Unicorn)$estimate,
            cor.test(df$Total_Raised_B, df$Years_to_Unicorn)$p.value))
```

## 4. Confidence Intervals

```{r confidence-intervals}
# Calculate 95% confidence intervals for mean valuation
valuation_clean <- na.omit(df$Valuation_B)
n <- length(valuation_clean)
mean_val <- mean(valuation_clean)
std_val <- sd(valuation_clean)
se <- std_val / sqrt(n)
t_critical <- qt(0.975, n - 1)

ci_lower <- mean_val - t_critical * se
ci_upper <- mean_val + t_critical * se
margin_error <- t_critical * se

cat("95% Confidence Interval for Mean Valuation:\n")
cat(sprintf("Mean: %.2fB\n", mean_val))
cat(sprintf("Confidence Interval: [%.2fB, %.2fB]\n", ci_lower, ci_upper))
cat(sprintf("Margin of Error: %.2fB\n", margin_error))
```

## Summary

This analysis provides comprehensive descriptive and inferential statistics for the Unicorn Companies dataset, including hypothesis tests and correlation analysis.


